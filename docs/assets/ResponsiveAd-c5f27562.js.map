{"version":3,"file":"ResponsiveAd-c5f27562.js","sources":["../../src/components/AdSlot/adScripts/getParameterByName.ts","../../src/components/AdSlot/adScripts/ias.ts","../../src/components/AdSlot/adScripts/bootstrap.ts","../../src/components/AdSlot/adScripts/loadScript.ts","../../src/components/AdSlot/OneTrust.svelte","../../src/components/AdSlot/AdScripts.svelte","../../src/components/AdSlot/utils.ts","../../src/components/AdSlot/AdSlot.svelte","../../src/components/AdSlot/ResponsiveAd.svelte"],"sourcesContent":["export default (name: string, url = window.location.href) => {\n  // eslint-disable-next-line no-useless-escape\n  name = name.replace(/[\\[\\]]/g, '\\\\$&');\n  const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');\n  const results = regex.exec(url);\n\n  if (!results) return null;\n\n  if (!results[2]) return '';\n\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n};\n","const IAS_REQUEST_TIMEOUT = 600;\n\nexport default () => {\n  return new Promise((resolve) => {\n    const timerId = setTimeout(() => {\n      resolve('Resolved with timeout');\n    }, IAS_REQUEST_TIMEOUT);\n\n    const setupIAS = () => {\n      clearTimeout(timerId);\n      (<any>window).__iasPET = (<any>window).__iasPET || {};\n      (<any>window).__iasPET.queue = (<any>window).__iasPET.queue || [];\n      (<any>window).__iasPET.pubId = '931336'; // Ask Rachel\n      resolve('loaded');\n    };\n\n    // Set up IAS pet.js\n    const script = document.createElement('script');\n    script.src = '//static.adsafeprotected.com/iasPET.1.js';\n    script.setAttribute('async', 'async');\n    document.head.appendChild(script);\n    script.onload = setupIAS;\n    script.onerror = () => {\n      resolve('error');\n    };\n  });\n};\n","import getParameterByName from './getParameterByName';\nimport Ias from './ias';\n\nconst ONETRUST_LOGS = 'ot_logs';\nconst ONETRUST_GEOLOCATION_MOCK = 'ot_geolocation_mock';\nconst ONETRUST_SCRIPT_ID = '38cb75bd-fbe1-4ac8-b4af-e531ab368caf-test';\n\nexport const loadBootstrap = () => {\n  (<any>window).freestar = (<any>window).freestar || {};\n  const freestar = (<any>window).freestar;\n  freestar.debug = true;\n  freestar.queue = freestar.queue || [];\n  freestar.config = freestar.config || {};\n  freestar.config.enabled_slots = [];\n  freestar.initCallback = function() {\n    freestar.config.enabled_slots.length === 0 ?\n      (freestar.initCallbackCalled = false) :\n      freestar.newAdSlots(freestar.config.enabled_slots);\n  };\n\n  freestar.config.channel = '/4735792/reuters.com/graphics';\n\n  (<any>window).initBootstrap(\n    {\n      onetrust_logs: getParameterByName(ONETRUST_LOGS) || 'false',\n      geolocation_mock:\n        getParameterByName(ONETRUST_GEOLOCATION_MOCK) || 'default',\n      onetrust_script_id: ONETRUST_SCRIPT_ID,\n    },\n    (onetrustResponse) => {\n      const iasPromise = Ias();\n      return Promise.all([iasPromise]).then((responses) => {\n        const [iasResponse] = responses;\n\n        return {\n          ...onetrustResponse,\n          ias: iasResponse,\n        };\n      });\n    }\n  );\n\n  (<any>window).bootstrap.getResults((result) => {\n    // Set GAM\n    window.googletag = (<any>window).googletag || { cmd: [] };\n    window.googletag.cmd.push(() => {\n      window.googletag.pubads().enableSingleRequest();\n      /**\n       * @TODO Property 'enableAsyncRendering' does not exist on type 'PubAdsService'.\n       */\n      // @ts-ignore\n      window.googletag.pubads().enableAsyncRendering();\n      window.googletag.pubads().collapseEmptyDivs(true);\n    });\n\n    // Set page-level key-values\n    // cf: https://help.freestar.com/help/using-key-values\n    freestar.queue.push(function() {\n      // Global Ads test targeting\n      const adstest = new URL(document.location.href).searchParams.get('adstest');\n      if (adstest) {\n        window.googletag.pubads().setTargeting('adstest', adstest);\n      }\n\n      // Use the URL path to create a unique ID for the page.\n      const graphicId = window.location.pathname.split('/')\n        // Get the first lowercase slug in the pathname, which is the graphic UID.\n        .filter(d => d.match(/[a-z0-9]+/) && d !== 'graphics')[0] || 'unknown-graphic';\n      window.googletag.pubads().setTargeting('template', 'graphics');\n      window.googletag.pubads().setTargeting('graphicId', graphicId);\n    });\n\n    if (!Array.isArray((<any>window).graphicsAdQueue)) {\n      console.error('Ad queue not initialized!');\n    }\n\n    freestar.queue.push(function() {\n      freestar.newAdSlots((<any>window).graphicsAdQueue || [], freestar.config.channel);\n    });\n  });\n};\n","interface attributesInterface {\n  onload?: () => void,\n  async?: boolean\n}\n\nexport const loadScript = (src: string, attributes?: attributesInterface) => {\n  const { onload, async = true } = attributes || {};\n\n  const existingScript = document.querySelector(`script[src=\"${src}\"]`);\n  if (existingScript) return;\n\n  const script = document.createElement('script');\n  script.addEventListener('load', onload);\n  script.async = async;\n  script.src = src;\n  document.head.append(script);\n};\n","<!-- This component manages the OneTrust prefs button, so it's not permanently fixed on page... -->\n<script>\n  import { onMount } from 'svelte';\n  import { throttle } from 'lodash-es';\n\n  let lastScroll = 0;\n  let showManagePreferences = true;\n\n  const togglePrefs = (on = true) => {\n    const btn = document.getElementById('ot-sdk-btn-floating');\n    if (!btn) return;\n    if (on) {\n      showManagePreferences = true;\n      btn.style.bottom = '';\n    } else {\n      showManagePreferences = false;\n      btn.style.bottom = '-5rem';\n    }\n  };\n\n  const handleScroll = () => {\n    if (lastScroll > window.scrollY) {\n      if (!showManagePreferences) {\n        togglePrefs(true);\n      }\n    } else {\n      if (showManagePreferences && window.scrollY > 250) {\n        togglePrefs(false);\n      }\n    }\n    lastScroll = window.scrollY;\n  };\n\n  onMount(() => {\n    window.addEventListener('scroll', throttle(handleScroll, 250), {\n      passive: true,\n    });\n  });\n</script>\n","<script>\n  import { onMount } from 'svelte';\n  import { loadBootstrap } from './adScripts/bootstrap';\n  import { loadScript } from './adScripts/loadScript';\n  import OneTrust from './OneTrust.svelte';\n\n  onMount(() => {\n    window.graphicsAdQueue = window.graphicsAdQueue || [];\n    loadScript(\n      'https://graphics.thomsonreuters.com/cdn/js/bootstrap.static.js',\n      { onload: loadBootstrap, async: false }\n    );\n    // Load Freestar script\n    loadScript('https://a.pub.network/reuters-com/pubfig.min.js');\n  });\n</script>\n\n<svelte:head>\n  <link rel=\"preconnect\" href=\"https://a.pub.network/\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://b.pub.network/\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://c.pub.network/\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://d.pub.network/\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://c.amazon-adsystem.com\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://s.amazon-adsystem.com\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://btloader.com/\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://api.btloader.com/\" crossorigin=\"\" />\n  <link\n    rel=\"preconnect\"\n    href=\"https://confiant-integrations.global.ssl.fastly.net\"\n    crossorigin=\"\"\n  />\n  <link rel=\"stylesheet\" href=\"https://a.pub.network/reuters-com/cls.css\" />\n</svelte:head>\n\n<OneTrust />\n","const random4 = () =>\n  Math.floor((1 + Math.random()) * 0x10000)\n    .toString(16)\n    .substring(1);\n\nexport const getRandomAdId = () => 'ad-' + random4() + random4();\n","<script lang=\"ts\">\n  import type {\n    DesktopAdType,\n    DesktopPlacementName,\n    MobileAdType,\n    MobilePlacementName,\n  } from './@types/ads';\n  import { onMount } from 'svelte';\n  import { getRandomAdId } from './utils';\n\n  export let placementName: DesktopPlacementName | MobilePlacementName;\n  export let adType: DesktopAdType | MobileAdType;\n\n  /**\n   * @TODO Unclear at what level this bit of config is used with placements...\n   */\n  export let dataFreestarAd: string = '__970x250';\n\n  const adId = getRandomAdId();\n\n  onMount(() => {\n    const adSlot = {\n      placementName,\n      slotId: adId,\n      targeting: {\n        div_id: placementName,\n        type: adType,\n      },\n    };\n    // @ts-ignore\n    const freestar = window?.freestar;\n    // Add adSlot to freestar queue directly if already initialised\n    if (freestar) {\n      freestar.queue.push(function () {\n        freestar.newAdSlots([adSlot], freestar.config.channel);\n      });\n      // ... otherwise add to the graphicsAdQueue queue.\n    } else {\n      window.graphicsAdQueue = window.graphicsAdQueue || [];\n      window.graphicsAdQueue.push(adSlot);\n    }\n\n    return () => {\n      // @ts-ignore\n      const freestar = window?.freestar;\n      if (freestar) {\n        freestar.queue.push(function () {\n          freestar.deleteAdSlots(adId);\n        });\n      }\n    };\n  });\n</script>\n\n<div data-freestar-ad=\"{dataFreestarAd || null}\" id=\"{adId}\"></div>\n\n<style lang=\"scss\">\n  div {\n    :global(iframe) {\n      width: auto;\n    }\n  }\n</style>\n","<script lang=\"ts\">\n  import type {\n    DesktopAdType,\n    DesktopPlacementName,\n    MobileAdType,\n    MobilePlacementName,\n  } from './@types/ads';\n  import AdSlot from './AdSlot.svelte';\n\n  export let desktopPlacementName: DesktopPlacementName;\n  export let mobileBreakpoint = 1024;\n\n  let windowWidth: number;\n\n  const getMobilePlacementName = (\n    desktopPlacementName: DesktopPlacementName\n  ): MobilePlacementName => {\n    switch (desktopPlacementName) {\n      case 'reuters_desktop_leaderboard_atf':\n        return 'reuters_mobile_leaderboard';\n      case 'reuters_sponsorlogo':\n        return 'reuters_sponsorlogo';\n      case 'reuters_desktop_native_1':\n        return 'reuters_mobile_mpu_1';\n      case 'reuters_desktop_native_2':\n        return 'reuters_mobile_mpu_2';\n      case 'reuters_desktop_native_3':\n        return 'reuters_mobile_mpu_3';\n      default:\n        return 'reuters_mobile_mpu_1';\n    }\n  };\n\n  const getAdType = (\n    placementName: DesktopPlacementName | MobilePlacementName\n  ): DesktopAdType | MobileAdType => {\n    switch (placementName) {\n      case 'reuters_desktop_leaderboard_atf':\n      case 'reuters_mobile_leaderboard':\n        return 'leaderboard';\n      case 'reuters_sponsorlogo':\n        return 'sponsorlogo';\n      case 'reuters_mobile_mpu_1':\n        return 'mpu';\n      case 'reuters_mobile_mpu_2':\n        return 'native';\n      case 'reuters_mobile_mpu_3':\n        return 'mpu2';\n      case 'reuters_desktop_native_1':\n        return 'native';\n      case 'reuters_desktop_native_2':\n        return 'canvas';\n      case 'reuters_desktop_native_3':\n        return 'flex';\n      default:\n        return 'native';\n    }\n  };\n\n  $: placementName =\n    windowWidth && windowWidth < mobileBreakpoint\n      ? getMobilePlacementName(desktopPlacementName)\n      : desktopPlacementName;\n  $: adType = getAdType(placementName);\n</script>\n\n<svelte:window bind:innerWidth=\"{windowWidth}\" />\n\n{#if windowWidth}\n  {#key placementName}\n    <AdSlot placementName=\"{placementName}\" adType=\"{adType}\" />\n  {/key}\n{/if}\n"],"names":["getParameterByName","name","url","results","IAS_REQUEST_TIMEOUT","Ias","resolve","timerId","setupIAS","script","ONETRUST_LOGS","ONETRUST_GEOLOCATION_MOCK","ONETRUST_SCRIPT_ID","loadBootstrap","freestar","onetrustResponse","iasPromise","responses","iasResponse","result","adstest","graphicId","d","loadScript","src","attributes","onload","async","lastScroll","showManagePreferences","togglePrefs","on","btn","handleScroll","onMount","throttle","append","link0","link1","link2","link3","link4","link5","link6","link7","link8","link9","random4","getRandomAdId","attr","div","div_data_freestar_ad_value","ctx","insert","target","anchor","dirty","placementName","$$props","adType","dataFreestarAd","adId","adSlot","create_if_block","desktopPlacementName","mobileBreakpoint","windowWidth","getMobilePlacementName","getAdType","$$invalidate"],"mappings":"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"}