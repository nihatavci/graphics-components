{"version":3,"file":"ReferralBlock.stories-6fc18d22.js","sources":["../../src/components/ReferralBlock/stories/docs/component.md?raw","../../src/components/ReferralBlock/stories/docs/collection.md?raw","../../src/components/ReferralBlock/ReferralBlock.svelte","../../src/components/ReferralBlock/ReferralBlock.stories.svelte"],"sourcesContent":["export default \"The `ReferralBlock` component creates a set of referral links from recent dotcom stories using the [recent stories by section API](https://www.reuters.com/pf/api/v3/content/fetch/recent-stories-by-sections-v1?query=%7B%22section_ids%22%3A%22%2Fworld%2F%22%2C%22size%22%3A20%2C%22website%22%3A%22reuters%22%7D) or the [articles by collection API](https://www.reuters.com/pf/api/v3/content/fetch/articles-by-collection-alias-or-id-v1?query=%7B%22collection_alias%22%3A%22x-trump%22%2C%22size%22%3A20%2C%22website%22%3A%22reuters%22%7D).\\n\\n> The `section` or `collection` prop determines which section or collection stories are from.\\n>\\n> You can get the section ID from the section page on dotcom. For example, the section ID for World - Europe stories at `www.reuters.com/world/europe/` would be `/world/europe/`. (The leading and trailing slashes are required!)\\n>\\n> You should get a collection alias from the dotcom team.\\n\\n```svelte\\n<script>\\n  import { ReferralBlock } from '@reuters-graphics/graphics-components';\\n</script>\\n\\n<ReferralBlock section=\\\"/lifestyle/sports/\\\" />\\n```\\n\"","export default \"```svelte\\n<script>\\n  import { ReferralBlock } from '@reuters-graphics/graphics-components';\\n</script>\\n\\n<ReferralBlock collection=\\\"x-trump\\\" number=\\\"{6}\\\" class=\\\"fmy-8\\\" />\\n```\\n\"","<!-- @component `ReferralBlock` [Read the docs.](https://reuters-graphics.github.io/graphics-components/?path=/docs/components-ReferralBlock--default) -->\n<script lang=\"ts\">\n  /** ✏️ DOCUMENT your chart's props using TypeScript and JSDoc comments like below! */\n\n  /**\n   * Section ID, which is often the URL path to the section page on reuters.com.\n   *\n   * Note that not all section pages will be available in the recent stories by section API.\n   */\n  export let section: string | undefined = '/world/';\n\n  /**\n   * Collection alias, as defined in Arc Collections editor.\n   */\n  export let collection: string | undefined;\n\n  /**\n   * Number of referrals to show.\n   * @required\n   */\n  export let number: number = 4;\n\n  /**\n   * Link [target](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attr-target), e.g., `_blank` or `_parent`.\n   */\n  export let linkTarget: string = '_self';\n\n  /**\n   * Add a heading to the referral block.\n   */\n  export let heading: string = '';\n\n  type ContainerWidth = 'normal' | 'wide' | 'wider' | 'widest' | 'fluid';\n\n  /**\n   * Width of the component within the text well.\n   * @required\n   */\n  export let width: ContainerWidth = 'wide';\n\n  /** Add an ID to target with SCSS. */\n  export let id: string = '';\n\n  /** Add a class to target with SCSS. */\n  let cls: string = 'fmy-8';\n  export { cls as class };\n\n  import Block from '../Block/Block.svelte';\n  // import { referrals } from './stores.js';\n\n  import { onMount } from 'svelte';\n  import { getTime } from '../SiteHeader/NavBar/NavDropdown/StoryCard/time';\n\n  let clientWidth;\n\n  const SECTION_API = 'recent-stories-by-sections-v1';\n  const COLLECTION_API = 'articles-by-collection-alias-or-id-v1';\n\n  let referrals = [];\n\n  onMount(async () => {\n    const isCollection = Boolean(collection);\n    const API = isCollection ? COLLECTION_API : SECTION_API;\n    try {\n      const response = await fetch(\n        `https://www.reuters.com/pf/api/v3/content/fetch/${API}?` +\n          new URLSearchParams({\n            query: JSON.stringify({\n              section_ids: isCollection ? undefined : section,\n              collection_alias: isCollection ? collection : undefined,\n              size: 20,\n              website: 'reuters',\n            }),\n          })\n      );\n      const data = await response.json();\n      const articles = data.result.articles\n        .filter((a) => a?.headline_category || a?.kicker?.name)\n        .filter((a) => a?.thumbnail?.renditions?.landscape?.['240w'])\n        .filter((a) => !a?.content?.third_party)\n        .slice(0, number);\n      referrals = articles;\n    } catch (e) {\n      console.warn('Unable to fetch referral links.');\n    }\n  });\n\n  getTime();\n</script>\n\n{#if referrals.length === number}\n  <Block width=\"{width}\" id=\"{id}\" class=\"referrals-block {cls}\">\n    {#if heading}\n      <div\n        class=\"heading h4 font-bold\"\n        class:stacked=\"{clientWidth && clientWidth < 750}\"\n      >\n        {heading}\n      </div>\n    {/if}\n    <div\n      class=\"referral-container inline-flex flex-wrap w-full justify-between\"\n      class:stacked=\"{clientWidth && clientWidth < 750}\"\n      class:xs=\"{clientWidth && clientWidth < 450}\"\n      bind:clientWidth=\"{clientWidth}\"\n    >\n      {#each referrals as referral}\n        <div class=\"referral\">\n          <a\n            href=\"https://www.reuters.com{referral.canonical_url}\"\n            target=\"{linkTarget}\"\n            rel=\"{linkTarget === '_blank' ? 'noreferrer' : null}\"\n          >\n            <div class=\"referral-pack flex justify-around my-0 mx-auto\">\n              <div\n                class=\"headline\"\n                class:xs=\"{clientWidth && clientWidth < 450}\"\n              >\n                <div\n                  class=\"kicker m-0 body-caption leading-tighter\"\n                  data-chromatic=\"ignore\"\n                >\n                  {referral.headline_category || referral.kicker.name}\n                </div>\n                <div\n                  class=\"title m-0 body-caption leading-tighter\"\n                  data-chromatic=\"ignore\"\n                >\n                  {referral.title}\n                </div>\n                <div\n                  class=\"publish-time body-caption leading-tighter\"\n                  data-chromatic=\"ignore\"\n                >\n                  {getTime(new Date(referral.display_time))}\n                </div>\n              </div>\n              <div\n                class=\"image-container block m-0 overflow-hidden relative\"\n                class:xs=\"{clientWidth && clientWidth < 450}\"\n              >\n                <img\n                  class=\"block object-cover m-0 w-full\"\n                  data-chromatic=\"ignore\"\n                  src=\"{referral.thumbnail.renditions.landscape['240w']}\"\n                  alt=\"{referral.thumbnail.caption ||\n                    referral.thumbnail.alt_text}\"\n                />\n              </div>\n            </div>\n          </a>\n        </div>\n      {/each}\n    </div>\n  </Block>\n{/if}\n\n<style lang=\"scss\">\n  @use '../../scss/mixins' as *;\n\n  div.heading {\n    &.stacked {\n      max-width: 450px;\n    }\n  }\n\n  .referral-container {\n    a {\n      text-decoration: none;\n    }\n    &.stacked {\n      .referral {\n        width: 100%;\n        .headline {\n          width: calc(100% - 7rem);\n        }\n      }\n    }\n    .referral {\n      display: block;\n      width: calc(50% - 30px);\n      max-width: 450px;\n      @include fmy-1;\n\n      &:hover {\n        .title {\n          text-decoration: underline;\n        }\n        img {\n          filter: brightness(85%);\n        }\n      }\n\n      .headline {\n        display: inline-block;\n        width: calc(100% - 9rem);\n        @include fpr-2;\n        &.xs {\n        }\n        .kicker {\n          @include text-xxs;\n        }\n        .title {\n          @include font-medium;\n          @include text-sm;\n          @include text-primary;\n        }\n        .publish-time {\n          @include text-xxs;\n        }\n      }\n      .image-container {\n        border-radius: 0.25rem;\n        border: 1px solid $theme-colour-brand-rules;\n        width: 9rem;\n        &.xs {\n          width: 7rem;\n        }\n        img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          transition: filter 0.1s;\n        }\n      }\n    }\n  }\n</style>\n","<script>\n  import { Meta, Template, Story } from '@storybook/addon-svelte-csf';\n\n  // @ts-ignore\n  import componentDocs from './stories/docs/component.md?raw';\n  // @ts-ignore\n  import collectionDocs from './stories/docs/collection.md?raw';\n\n  import ReferralBlock from './ReferralBlock.svelte';\n\n  import { withComponentDocs, withStoryDocs } from '$docs/utils/withParams.js';\n\n  const metaProps = {\n    ...withComponentDocs(componentDocs),\n    argTypes: {\n      width: {\n        control: 'select',\n        options: ['normal', 'wide', 'wider', 'widest', 'fluid'],\n      },\n      section: {\n        control: 'select',\n        options: [\n          '/world/',\n          '/world/europe/',\n          '/lifestyle/',\n          '/lifestyle/sports/',\n          '/legal/',\n          '/business/',\n          '/business/energy/',\n        ],\n      },\n      number: {\n        control: 'select',\n        options: [2, 4, 6, 8],\n      },\n    },\n  };\n</script>\n\n<Meta\n  title=\"Components/ReferralBlock\"\n  component=\"{ReferralBlock}\"\n  {...metaProps}\n/>\n\n<Template let:args>\n  <ReferralBlock {...args} />\n</Template>\n\n<Story\n  name=\"Default\"\n  args=\"{{\n    section: '/lifestyle/sports/',\n    number: 4,\n    class: 'fmy-0',\n    heading: 'More World Cup coverage',\n  }}\"\n/>\n\n<Story\n  name=\"By collection\"\n  args=\"{{\n    collection: 'x-trump',\n    number: 6,\n    class: 'fmy-8',\n    heading: 'The latest Trump coverage',\n  }}\"\n  {...withStoryDocs(collectionDocs)}\n/>\n"],"names":["componentDocs","collectionDocs","ctx","insert","target","div","anchor","t0_value","t2_value","t4_value","getTime","src_url_equal","img","img_src_value","attr","a","a_href_value","a_rel_value","div6","append","div5","div3","div0","div1","div2","div4","dirty","set_data","t0","t2","t4","create_if_block_1","i","create_if_block","SECTION_API","COLLECTION_API","section","$$props","collection","number","linkTarget","heading","width","id","cls","clientWidth","referrals","onMount","isCollection","API","articles","_a","_c","_b","$$invalidate","ReferralBlock","withStoryDocs","withComponentDocs"],"mappings":"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"}